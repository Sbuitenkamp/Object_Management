@page
@using Object_management.Entity
@model Object_management.Pages.Objects.Index

@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="nl">
<partial name="_HeadPartial"/>
<body>
<partial name="_MenuPartial"/>
<div class="hidden">
    <div class="hidden__background"></div>
    <div class="hidden__content">
        <button onclick="closeHidden();" class="hidden__close-button button"><i class="fa-solid fa-x"></i></button>
        @if (@Model.ObjectTypeList.Count != 0) {
            <table class="hidden__content__table">
                <thead class="hidden__content__table__head">
                <tr class="hidden__content__table__head__row">
                    <td class="hidden__content__table__head__row__element">Omschrijving</td>
                    <td class="hidden__content__table__head__row__element">Prijs</td>
                    <td class="hidden__content__table__head__row__element">Aanbiedingen</td>
                    <td class="hidden__content__table__head__row__element"></td>
                </tr>
                </thead>
                <tbody>
                <input type="hidden" name="type" value="ObjectType">
                @foreach (ObjectType objectType in Model.ObjectTypeList) {
                    <form method="post" id="@objectType.id"></form>
                    <tr class="hidden__content__table__body">
                        <td class="hidden__content__table__body__element">
                            <input type="text" name="description" form="@objectType.id" value="@objectType.description">
                        </td>
                        <td class="hidden__content__table__body__element">
                            &euro;<input type="text" name="price" form="@objectType.id" value="@($"{objectType.price:0.00}")">
                        </td>
                        <td class="hidden__content__table__body__element">
                            @if (Model.SalesList.Count == 0) {
                                <p>Geen</p>
                            } else {
                                foreach (Sale sale in Model.SalesList.GroupBy(x => x.id).Select(y => y.FirstOrDefault())) {
                                    <input type="checkbox" class="float" form="@objectType.id" name="sale@(sale.id)" checked="@(Model.SalesList.Where(x => x.days_to_rent == sale.days_to_rent && x.object_type_id == objectType.id).ToList().Count != 0)">
                                    <label for="sale@(sale.id)" class="float">@(sale.days_to_rent)-@(sale.days_to_pay)</label>
                                }
                            }
                        </td>
                        <td class="hidden__content__table__body__element">
                            <button onclick="deleteType(@objectType.id)" class="hidden__content__table__body__element button button--delete"><i class="fa-solid fa-trash-can"></i></button>
                        </td>
                    </tr>
                }
                </tbody>
            </table>
            <button onclick="onClickUpdate('edit', 'ObjectType', true);" name="updateObjectTypes" class="hidden__update-button button">Gegevens aanpassen</button>
            <a href="/objects/addtype" class="hidden__add-button button">Fietssoort Toevoegen</a>
        } else {
            <h1>Geen data gevonden</h1>
        }
    </div>
</div>
<div class="content">
    <h1 class="warning">@ViewData["warning"]</h1>
    <h1 class="confirmation">@ViewData["confirmation"]</h1>
    <h1 class="content__title">Fietsen</h1>
        @if (Model.ObjectList.Count != 0 ) {
            <button onclick="openHidden();" name="fetchObjects" class="content__type-button button">Fietssoorten bewerken</button>
            
            <table class="content__table">
                <thead class="content__table__head">
                <tr class="content__table__head__row">
                    <td class="content__table__head__row__element">Fietsnummer</td>
                    <td class="content__table__head__row__element">Fietssoort</td>
                    <td class="content__table__head__row__element">Prijs</td>
                    <td class="content__table__head__row__element">Verhuurd</td>
                    <td class="content__table__head__row__element">In onderhoud</td>
                    <td class="content__table__head__row__element">Aanbiedingen</td>
                </tr>
                </thead>
                <tbody class="content__table__body">
                <input type="hidden" name="type" value="Object">
                @foreach (ObjectData obj in Model.ObjectList) {
                    <form method="post" id="@obj.object_number"></form>
                    <tr class="content__table__body">
                        <td class="content__table__body__element">
                            <input disabled="disabled" type="text" name="object_number" form="@obj.object_number" value="@obj.object_number">
                        </td>
                        <td class="content__table__body__element">
                            <!--                    TODO: make select dropdown-->
                            <select name="object_type" form="@obj.object_number">
                                @foreach (ObjectType objectType in Model.ObjectTypeList) {
                                    <option selected="@(objectType.id == obj.object_type_id)" value="@objectType.id">@objectType.description</option>
                                }
                            </select>
                        </td>
                        <td class="content__table__body__element">
                            &euro;<input disabled="disabled" type="text" name="price" form="@obj.object_number" value="@($"{obj.price:0.00}")">
                        </td>
                        <td class="content__table__body__element">
                            <input type="checkbox" name="loaned_out" form="@obj.object_number" checked="@obj.loaned_out">
                        </td>
                        <td class="content__table__body__element">
                            <input type="checkbox" name="in_service" form="@obj.object_number" checked="@obj.in_service">
                        </td>
                        <td>
                            @foreach (Sale sale in Model.SalesList.Where(x => x.object_type_id == obj.object_type_id)) {
                                <p class="float">@(sale.days_to_rent)-@(sale.days_to_pay)</p>
                            }
                        </td>
                    </tr>
                }
                </tbody>
            </table>
            <button onclick="onClickUpdate('edit', 'Object', false);" name="updateObjects" class="content__update-button button">Gegevens aanpassen</button>
        } else {
            <h1>Geen data gevonden</h1>
        }
</div>
</body>
</html>